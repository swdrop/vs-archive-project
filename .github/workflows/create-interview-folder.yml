name: create interview folder on _metadata.csv upload
on:
  push:
    paths:
      - 'uploads/*_metadata.csv'

jobs:
  process_csv:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Create interview folder, move csv, and delete original upload
        run: |
          for filepath in uploads/*_metadata.csv; do
            [ -f "$filepath" ] || continue
            filename=$(basename "$filepath" .csv)
            target_dir="interviews/${filename}"
            
            # Create interview folder
            mkdir -p "$target_dir"

            # Move the csv into the new folder
            mv "$filepath" "$target_dir/${filename}.csv"

            # Optionally add a README or log
            echo "# interview: $filename" > "$target_dir/README.md"
          done

      - name: Commit changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add interviews/
          git rm -f uploads/*.csv || echo "Nothing to remove"
          git commit -m "create interview folder from _metadata.csv upload" || echo "No changes to commit"
          git push

